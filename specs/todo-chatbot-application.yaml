apiVersion: v1
kind: ApplicationSpec
metadata:
  name: todo-chatbot-application
  version: "1.0.0"
  description: "Todo Chatbot application with React frontend, FastAPI backend, and PostgreSQL database"
  repository: "https://github.com/todo-chatbot/todo-chatbot"
  documentation: "https://todo-chatbot.local/docs"
architecture:
  pattern: microservices
  components: 3
components:
  - name: todo-frontend
    type: web
    technology: react
    version: "18.x"
    deployment:
      type: deployment
      replicas: 2
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 1
          maxUnavailable: 0
    container:
      image:
        repository: todo-frontend
        tag: latest
        pullPolicy: IfNotPresent
      ports:
        - name: http
          containerPort: 3000
          protocol: TCP
      resources:
        requests:
          cpu: "100m"
          memory: "128Mi"
        limits:
          cpu: "500m"
          memory: "256Mi"
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        readOnlyRootFilesystem: false
        capabilities:
          drop: ["ALL"]
    environment:
      variables:
        - name: REACT_APP_API_URL
          value: "http://todo-backend:8000"
    healthChecks:
      liveness:
        type: http
        path: "/health"
        port: 3000
        initialDelaySeconds: 30
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 3
      readiness:
        type: http
        path: "/health"
        port: 3000
        initialDelaySeconds: 5
        periodSeconds: 5
        timeoutSeconds: 3
        failureThreshold: 3
    persistence:
      enabled: false
    networking:
      service:
        type: ClusterIP
        port: 80
        targetPort: 3000
      ingress:
        enabled: true
        hosts:
          - host: "todo-chatbot.local"
            paths:
              - path: "/"
                pathType: Prefix
                service: frontend
        tls:
          enabled: true
          secretName: "todo-chatbot-tls"
    autoscaling:
      enabled: false
    podDisruptionBudget:
      enabled: true
      minAvailable: 1
    dependencies:
      internal:
        - name: todo-backend
          type: sync
          protocol: http
          required: true
    security:
      authentication:
        enabled: false
      authorization:
        enabled: false
      networkPolicies:
        enabled: true
        ingress:
          - from:
              - podSelector:
                  matchLabels:
                    app: todo-backend
        egress:
          - to:
              - podSelector:
                  matchLabels:
                    app: todo-backend
    observability:
      logging:
        level: info
        format: json
        output: stdout
      metrics:
        enabled: true
        endpoint: "/metrics"
        port: 3000
      tracing:
        enabled: false
        sampler: probabilistic
        rate: 0.1
    testing:
      unit:
        framework: jest
        coverage: 80
      integration:
        enabled: true
        dependencies: ["todo-backend"]
      e2e:
        enabled: true
        scenarios: ["create-todo", "complete-todo", "delete-todo"]
    performance:
      slos:
        - metric: latency
          target: "p95 < 200ms"
          window: "1h"
        - metric: availability
          target: "99.9%"
          window: "1h"
      limits:
        maxConcurrentRequests: 100
        requestTimeout: "30s"
      rateLimiting:
        enabled: false

  - name: todo-backend
    type: api
    technology: fastapi
    version: "0.104.x"
    deployment:
      type: deployment
      replicas: 2
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 1
          maxUnavailable: 0
    container:
      image:
        repository: todo-backend
        tag: latest
        pullPolicy: IfNotPresent
      ports:
        - name: http
          containerPort: 8000
          protocol: TCP
      resources:
        requests:
          cpu: "200m"
          memory: "256Mi"
        limits:
          cpu: "1000m"
          memory: "512Mi"
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        readOnlyRootFilesystem: false
        capabilities:
          drop: ["ALL"]
    environment:
      variables:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: postgres-credentials
              key: url
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: openai-credentials
              key: api-key
        - name: SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: backend-secrets
              key: secret-key
    healthChecks:
      liveness:
        type: http
        path: "/health"
        port: 8000
        initialDelaySeconds: 30
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 3
      readiness:
        type: http
        path: "/health"
        port: 8000
        initialDelaySeconds: 10
        periodSeconds: 5
        timeoutSeconds: 3
        failureThreshold: 3
      startup:
        type: http
        path: "/health"
        port: 8000
        failureThreshold: 30
        periodSeconds: 10
    persistence:
      enabled: false
    networking:
      service:
        type: ClusterIP
        port: 80
        targetPort: 8000
      ingress:
        enabled: true
        hosts:
          - host: "todo-chatbot.local"
            paths:
              - path: "/api"
                pathType: Prefix
                service: backend
        tls:
          enabled: true
          secretName: "todo-chatbot-tls"
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 5
      metrics:
        - type: Resource
          name: cpu
          target:
            type: Utilization
            value: 70
    podDisruptionBudget:
      enabled: true
      minAvailable: 1
    dependencies:
      internal:
        - name: postgres
          type: sync
          protocol: postgresql
          required: true
      external:
        - name: openai-api
          type: api
          endpoint: "https://api.openai.com/v1"
          authentication:
            type: apiKey
            secretRef: "openai-credentials"
    data:
      databases:
        - name: postgres
          type: postgresql
          version: "15-alpine"
          persistence:
            enabled: true
            size: "5Gi"
            backup:
              enabled: true
              schedule: "0 2 * * *"
    security:
      authentication:
        enabled: true
        method: jwt
        provider: builtin
      authorization:
        enabled: true
        method: rbac
      networkPolicies:
        enabled: true
        ingress:
          - from:
              - podSelector:
                  matchLabels:
                    app: todo-frontend
              - podSelector:
                  matchLabels:
                    app: todo-backend
        egress:
          - to:
              - podSelector:
                  matchLabels:
                    app: postgres
    observability:
      logging:
        level: info
        format: json
        output: stdout
      metrics:
        enabled: true
        endpoint: "/metrics"
        port: 8000
      tracing:
        enabled: true
        sampler: probabilistic
        rate: 0.1
    testing:
      unit:
        framework: pytest
        coverage: 85
      integration:
        enabled: true
        dependencies: ["postgres"]
      e2e:
        enabled: true
        scenarios: ["create-todo", "complete-todo", "delete-todo"]
    performance:
      slos:
        - metric: latency
          target: "p95 < 100ms"
          window: "1h"
        - metric: availability
          target: "99.9%"
          window: "1h"
      limits:
        maxConcurrentRequests: 1000
        requestTimeout: "30s"
      rateLimiting:
        enabled: true
        rate: "100 requests/minute"

  - name: postgres
    type: database
    technology: postgresql
    version: "15-alpine"
    deployment:
      type: statefulset
      replicas: 1
      strategy:
        type: RollingUpdate
    container:
      image:
        repository: postgres
        tag: "15-alpine"
        pullPolicy: IfNotPresent
      ports:
        - name: postgres
          containerPort: 5432
          protocol: TCP
      resources:
        requests:
          cpu: "100m"
          memory: "256Mi"
        limits:
          cpu: "500m"
          memory: "512Mi"
      securityContext:
        runAsNonRoot: true
        runAsUser: 999
        readOnlyRootFilesystem: false
        capabilities:
          drop: ["ALL"]
    environment:
      variables:
        - name: POSTGRES_DB
          value: "tododb"
        - name: POSTGRES_USER
          valueFrom:
            secretKeyRef:
              name: postgres-credentials
              key: username
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: postgres-credentials
              key: password
    healthChecks:
      liveness:
        type: exec
        command: ["pg_isready", "-U", "$(POSTGRES_USER)", "-d", "$(POSTGRES_DB)"]
        initialDelaySeconds: 60
        periodSeconds: 30
        timeoutSeconds: 10
        failureThreshold: 3
      readiness:
        type: exec
        command: ["pg_isready", "-U", "$(POSTGRES_USER)", "-d", "$(POSTGRES_DB)"]
        initialDelaySeconds: 10
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 3
    persistence:
      enabled: true
      storageClass: standard
      size: "5Gi"
      mountPath: "/var/lib/postgresql/data"
      accessModes: ["ReadWriteOnce"]
    networking:
      service:
        type: ClusterIP
        port: 5432
        targetPort: 5432
    autoscaling:
      enabled: false
    podDisruptionBudget:
      enabled: true
      minAvailable: 1
    dependencies:
      internal: []
      external: []
    data:
      databases:
        - name: tododb
          type: postgresql
          version: "15-alpine"
          persistence:
            enabled: true
            size: "5Gi"
            backup:
              enabled: true
              schedule: "0 2 * * *"
    security:
      authentication:
        enabled: true
        method: password
        provider: builtin
      authorization:
        enabled: true
        method: builtin
      networkPolicies:
        enabled: true
        ingress:
          - from:
              - podSelector:
                  matchLabels:
                    app: todo-backend
        egress: []
    observability:
      logging:
        level: info
        format: text
        output: stdout
      metrics:
        enabled: true
        endpoint: "/metrics"
        port: 9187
      tracing:
        enabled: false
    testing:
      unit: {}
      integration: {}
      e2e: {}
    performance:
      slos: []
      limits:
        maxConcurrentRequests: 100
        requestTimeout: "30s"
      rateLimiting: {}